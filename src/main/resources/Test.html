<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>
<body>
<div id="app">
    账　号:<input type="text" name="sendUser" id="sendUser"/>
    <input type="button" id="login" value="登录" οnclick="login()"/>
    <input type="button" οnclick="closewebsocketet()" value="退出"/>
    在线人数:<font id="count"></font>　　　连接状态:<font id="status"></font>

    <br/>
    接收人:<input type="text" name="toUser" id="toUser"/><br/>
    消息框:<br/>
    <textarea rows="5" cols="5" name="showMsg" disabled="disabled"
              style="width: 302px; height: 111px; ">{{ msg.message }}</textarea><br/>
    <textarea rows="5" cols="5" id="message" name="sendMsg" style="width: 302px; height: 111px; "
              v-model="msg.message"></textarea><br/>
    <input type="button" value="发送" @click="websocketSend()"/>　
</div>
</body>
<script>
    new Vue({
        el: '#app',
        data: {
            path: 'ws://127.0.0.1:8081/websocket/ws/',
            msg: {
                from: {},
                accept: {},
                message: '',
                websocket: {}
            }
        },
        created() {
            if (typeof (WebSocket) === 'undefined') {
                console.log('您的浏览器不支持WebSocket')
            } else {
                // console.log('您的浏览器支持WebSocket')
                this.initWebSocket();
            }
        },
        destroyed() {
            this.websocket.close() //离开路由之后断开websocketet连接
        },
        methods: {
            initWebSocket() { //初始化weosocket
                this.websocket = new WebSocket(this.path);
                this.websocket.onmessage = this.websocketOnMessage;
                this.websocket.onopen = this.websocketOnOpen;
                this.websocket.onerror = this.websocketetonerror;
                this.websocket.onclose = this.websocketClose;
            },
            websocketOnOpen() { //连接建立之后执行send方法发送数据
                console.log(this.websocket.readyState)
                this.websocketSend(JSON.stringify(this.msg));
            },
            websocketetonerror() {//连接建立失败重连
                this.initWebSocket();
            },
            websocketOnMessage(e) { //数据接收
               // const redata = JSON.parse(e.data);
            },
            websocketSend(Data) {//数据发送
                this.websocket.send(Data);
            },
            websocketClose(e) {  //关闭
                console.log('断开连接', e);
            },
        }
    })
</script>
</html>
